* DIEBR test $Id$
sysclear
archmode esame
r 1a0=00000001800000000000000000000200 # z/Arch restart PSW
r 1d0=000000018000000000000000000002E0 # z/Arch pgm new PSW
r 200=B7000320     # LCTL R0,R0,CTLR0  Set CR0 bit 45
r 204=B29D0324     # LFPC FPCREG       Load value into FPC register
r 208=41000008     # LA R0,8           R0=Number of test data
r 20C=41100800     # LA R1,TEST1       R1=>Test data table
r 210=41F00900     # LA R15,RES1       R15=>Result table
r 214=1B88         # SR R8,R8          Clear CC register
r 216=D70FF000F000 #A XC 0(16,R15),0(R15)  Clear result table entry
r 21C=78401000     # LE F4,0(,R1)      Load FPR4=TESTn
r 220=78501004     # LE F5,4(,R1)      Load FPR5=TESTn+4
r 224=B29D1008     # LFPC 8(R1)        Load FPC=TESTn+8
r 228=7830032C     # LE F3,JUNKWORD    Load initial pattern into FPR3
r 22C=B3533045     # DIEBR F4,F3,F5,0  Divide FPR4 by FPR5
r 230=B2220080     # IPM R8            R8=Cond code and pgm mask
r 234=7040F000     #B ST F4,0(,R15)    Store remainder in result table
r 238=7030F004     # ST F3,4(,R15)     Store quotient in result table
r 23C=BE88F008     # STCM R8,B'1000',8(R15)  Store CC in table
r 240=B29CF00C     # STFPC 12(R15)     Store FPC in table
r 244=41F0F010     # LA R15,16(,R15)   R15=>next result table
r 248=41101010     # LA R1,16(,R1)     R1=>Next TESTn
r 24C=46000216     # BCT R0,A          Loop to end of TEST table
r 250=41000900     # LA R0,RES1        R0->Actual results
r 254=41100080     # LA R1,8*16        R1=Length of results table
r 258=41200C00     # LA R2,EXP1        R2->Expected results
r 25C=41300080     # LA R3,8*16        R3=Length of results table
r 260=0F02         # CLCL R0,R2        Compare with expected results
r 262=477002FC     # BNE DIE           Error if not equal
r 266=B2B20300     # LPSWE WAITPSW     Load enabled wait PSW
r 2E0=92FFF009     #PGM MVI 9(R15),X'FF' Indicate program check
r 2E4=D201F00A008E # MVC 10(2,R15),PGMINT+2  Save interrupt code in result table
r 2EA=BF880152     # ICM R8,B'1000',PGMOPSW+2  R8=cond code from old PSW
r 2EE=47F00234     # B B               Continue to next test
r 2FC=B2B20310     #DIE LPSWE DISWAIT  Load disabled wait PSW
r 300=07020001800000000000000000AAAAAA # WAITPSW Enabled wait state PSW
r 310=00020001800000000000000000BADBAD # DISWAIT Disabled wait state PSW
r 320=00040000     # CTLR0             Control register 0 (bit45 AFP control)
r 324=00000000     # FPCREG            Floating point control register
r 328=00000000     # COUNT             Error counter
r 32C=DEADBEEF     # JUNKWORD          Initial pattern
*     <--F4--><--F5--><--FPC->         Test data
r 800=FF8000008000000000000001         # TEST1 -INF,-0,BRM=Z
r 810=7F8000007FC1234500000001         # TEST2 +INF,QNAN(12345),BRM=Z
r 820=7F8000007F82345600000001         # TEST3 +INF,SNAN(23456),BRM=Z
r 830=7FC123457FC5678900000001         # TEST4 QNAN(12345),QNAN(56789),BRM=Z
r 840=7F8345677F85678900000001         # TEST5 SNAN(34567),SNAN(56789),BRM=Z
r 850=40E000004000000000000001         # TEST6 EB'7',EB'2'
r 860=3E000FF8163FFEFF00000001         # TEST7
r 870=FF0D7C30007FFFFF00000001         # TEST8
*     <--F4--><--F3--><C--INT><--FPC->   Expected results, condition codes, and FPC
r C00=7FC000007FC000001000000000800001 # EXP1 DNAN,DNAN,CC1,INV
r C10=7FC123457FC123451000000000000001 # EXP2 QNAN(12345),QNAN(12345),CC1
r C20=7FC234567FC234561000000000800001 # EXP3 QNAN(23456),QNAN(23456),CC1,INV
r C30=7FC123457FC123451000000000000001 # EXP4 QNAN(12345),QNAN(12345),CC1
r C40=7FC345677FC345671000000000800001 # EXP5 QNAN(34567),QNAN(34567),CC1,INV
r C50=3F800000404000000000000000000001 # EXP6 EB'1',EB'3',CC0
r C60=322B99D9672AC0D92000000000000001 # EXP7 EB'',EB'',CC2
r C70=F1D7C310DE0D7C313000000000000001 # EXP8 EB'',EB'',CC3
pgmtrace +7
restart
pause 1
* Display test data
r 800.80
* Display expected results
r C00.80
* Display actual results
r 900.80
